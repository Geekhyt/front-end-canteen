---
title: "JavaScripté—­åŒ…(è®²ç»™æ–°æ¥çš„å¥³å®ä¹ ç”Ÿ)"
date: 2019-08-15T16:22:42+08:00
lastmod: 2019-08-25T16:22:42+08:00
draft: false
description: "JavaScripté—­åŒ…"
show_in_homepage: true
show_description: false
license: ''

tags: ['JavaScript']
categories: ['å‰ç«¯']

featured_image: ''
featured_image_preview: ''

comment: true
toc: true
autoCollapseToc: true
math: true
---

æ’©å¦¹å®ˆåˆ™ç¬¬ä¸€æ¡ï¼Œå¥³å­©å­éƒ½å–œæ¬¢ç«¥è¯æ•…äº‹ã€‚

é‚£å°±å…ˆæ¥è®²ä¸€ä¸ªç«¥è¯æ•…äº‹~

<!--more-->



```javascript
// æœ‰ä¸€ä¸ªå…¬ä¸»
// å¥¹ç”Ÿæ´»åœ¨ä¸€ä¸ªå……æ»¡å†’é™©çš„å¥‡å¦™ä¸–ç•Œé‡Œ
// å¥¹é‡è§äº†å¥¹çš„ç™½é©¬ç‹å­ï¼Œå¸¦ç€å¥¹éª‘ç€ç‹¬è§’å…½ç¯æ¸¸ä¸–ç•Œ
// ä¸é¾™ææ–—ï¼Œé‡åˆ°äº†ä¼šè¯´è¯çš„æ¾é¼ ï¼Œä»¥åŠè®¸å¤šå…¶ä»–å¹»æƒ³çš„äº‹æƒ…ã€‚
function princess () {
    var adventrures = [];
    function princeCharming () {};
    var unicorn = {};
    var dragons = [];
    var squirrel = "Hello!";
    // ä½†å¥¹ä¸å¾—ä¸å›åˆ°å¥¹é‚£å……æ»¡å®¶åŠ¡å’Œå¤§äººä»¬çš„å•è°ƒä¸–ç•Œã€‚
    return {
    // å¥¹ç»å¸¸ç»™èº«è¾¹çš„äººè®²å¥¹ä½œä¸ºä¸€ä¸ªå…¬ä¸»çš„å¥‡å¦™ç»å†ã€‚
      story:function () {
          return adventures[adventures.length - 1];
      }
    }
}
// ä½†ä»–ä»¬çœ‹åˆ°çš„åªæ˜¯ä¸€ä¸ªå°å¥³å­©åœ¨è®²è¿°å…³äºé­”æ³•å’Œå¹»æƒ³çš„æ•…äº‹
var littleGril = princess();
littleGril.story();
// å³ä½¿å¤§äººä»¬çŸ¥é“å¥¹æ˜¯çœŸæ­£çš„å…¬ä¸»ï¼Œä»–ä»¬ä¹Ÿä¸ä¼šç›¸ä¿¡æ‰€è°“çš„ç‹¬è§’å…½æˆ–é¾™ï¼Œå› ä¸ºä»–ä»¬æ°¸è¿œçœ‹ä¸åˆ°å®ƒä»¬
// å¤§äººä»¬è¯´å®ƒä»¬åªå­˜åœ¨äºå°å¥³å­©çš„æƒ³è±¡ä¸­
// ä½†æˆ‘ä»¬çŸ¥é“çœŸæ­£çš„çœŸç†
// é‡Œé¢çš„å°å¥³å­©çœŸçš„æ˜¯ä¸ªå…¬ä¸»
```

è¿™ä¸ªæ•…äº‹æ¥è‡ªäº[stackoverflowçš„ä¸€åˆ™å›ç­”](https://stackoverflow.com/questions/111102/how-do-javascript-closures-work/111111#111111)ï¼Œçœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œç­‰é˜…è¯»å®Œæœ¬æ–‡åï¼Œå›å¤´å†æ¥çœ‹è¿™ä¸ªæ•…äº‹ï¼Œä½ ä¼šå‘ç°ä½ å·²ç»å®Œå…¨äº†è§£äº†æˆ‘çš„é­…åŠ›ï¼Œå’³å’³@Â¥%#â€¦â€¦â€¦â€¦`JavaScript`ä¸­é—­åŒ…çš„é­…åŠ›ã€‚


## ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ
`å½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸæ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œã€‚    --- ä½ ä¸çŸ¥é“çš„JavaScript(ä¸Šå·)`

æ¥ä¸ªğŸŒ°

```javascript
function demo() {
    var a = 1;
    return function () {
        return a; 
    }
}

var a = demo();
console.log(a());  // 1
```
### é—­åŒ…çš„æ„æˆ

é—­åŒ…ç”±ä¸¤éƒ¨åˆ†æ„æˆï¼š**å‡½æ•°ï¼Œä»¥åŠåˆ›å»ºè¯¥å‡½æ•°çš„ç¯å¢ƒã€‚**

ç¯å¢ƒç”±é—­åŒ…åˆ›å»ºæ—¶åœ¨ä½œç”¨åŸŸä¸­çš„ä»»ä½•å±€éƒ¨å˜é‡ç»„æˆã€‚

### é—­åŒ…çš„æœ¬è´¨

**é—­åŒ…å…¶å®æ˜¯`JavaScript`å‡½æ•°ä½œç”¨åŸŸçš„å‰¯ä½œç”¨äº§å“ã€‚**

**é—­åŒ…æ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ã€‚**

æ‰€è°“`æœ‰æ„æ ½èŠ±èŠ±ä¸å¼€,æ— å¿ƒæ’æŸ³æŸ³æˆè«`ï¼Œä¸æ˜¯`JavaScript`æ•…æ„è¦ä½¿ç”¨é—­åŒ…ï¼Œè€Œæ˜¯ç”±äº`JavaScript`çš„å‡½æ•°å†…éƒ¨å¯ä»¥ä½¿ç”¨å‡½æ•°å¤–éƒ¨çš„å˜é‡ï¼Œè¿™æ®µä»£ç åˆ**åˆšåˆšå¥½**ç¬¦åˆé—­åŒ…çš„å®šä¹‰ã€‚

åœ¨`JavaScript`ä¸­ï¼Œå¤–éƒ¨å‡½æ•°è°ƒç”¨ä¹‹åå…¶å˜é‡å¯¹è±¡æœ¬åº”è¯¥è¢«é”€æ¯ï¼Œä½†é—­åŒ…é˜»æ­¢äº†å®ƒä»¬çš„é”€æ¯ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„å˜é‡å¯¹è±¡ã€‚

è¿›ä¸€æ­¥çš„è¯´ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œå‡½æ•°çš„ä½œç”¨åŸŸåŠå…¶æ‰€æœ‰å˜é‡éƒ½ä¼šåœ¨å‡½æ•°æ‰§è¡Œç»“æŸåè¢«é”€æ¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœåˆ›å»ºäº†ä¸€ä¸ªé—­åŒ…çš„è¯ï¼Œè¿™ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸå°±ä¼šä¸€ç›´ä¿å­˜åˆ°é—­åŒ…ä¸å­˜åœ¨ä¸ºæ­¢ã€‚

```javascript
function addCalculator (x) {
    return function (y) {
        return x + y;
    }
}

var add1 = addCalculator(1);

console.log(add1(1)); //2

// é‡Šæ”¾å¯¹é—­åŒ…çš„å¼•ç”¨
add1 = null;

console.log(add1(1)); //Uncaught TypeError: add1 is not a function

```

### é—­åŒ…çš„åº”ç”¨
æˆ‘ä»¬å¯ä»¥ç”¨é—­åŒ…æ¥åšä»€ä¹ˆå‘¢ï¼Ÿ

äº†è§£`Java`çš„åŒå­¦å¯èƒ½çŸ¥é“ï¼Œ`Java`æ˜¯æ”¯æŒç§æœ‰æ–¹æ³•çš„ï¼Œç§æœ‰æ–¹æ³•åªèƒ½è¢«ä¸€ä¸ªç±»ä¸­çš„å…¶ä»–æ–¹æ³•æ‰€è°ƒç”¨ï¼Œä½†æ˜¯`JavaScript`æ²¡æœ‰æä¾›è¿™ç§åŸç”Ÿæ”¯æŒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡é—­åŒ…æ¥æ¨¡æ‹Ÿç§æœ‰æ–¹æ³•ã€‚

ç§æœ‰æ–¹æ³•è‡ªç„¶æœ‰ç§æœ‰æ–¹æ³•çš„å¥½å¤„ï¼Œç§æœ‰æ–¹æ³•æœ‰åˆ©äºé™åˆ¶å¯¹ä»£ç çš„è®¿é—®ï¼Œè€Œä¸”å¯ä»¥é¿å…éæ ¸å¿ƒçš„æ–¹æ³•å¹²æ‰°ä»£ç çš„å…¬å…±æ¥å£ï¼Œå‡å°‘å…¨å±€æ±¡æŸ“ã€‚

æ¥ä¸ªğŸŒ°

```javascript
var calculator = (function(){
    var a = 1;
    function addCalculator(val){
        a += val
    }
    return {
        add1:function() {
            addCalculator(1);
        },
        add2:function() {
            addCalculator(2);
        },
        result:function() {
            return a
        }
    }
})();

console.log(calculator.result());  // 1
calculator.add1();
console.log(calculator.result());  // 2
calculator.add2();
console.log(calculator.result());  // 4
```

ä¸Šé¢è¿™ç§æ–¹å¼ä¹Ÿå«åš**æ¨¡å—æ¨¡å¼(module pattern)**ã€‚


### ä½¿ç”¨é—­åŒ…çš„æ³¨æ„äº‹é¡¹

#### å†…å­˜æ³„æ¼

å› ä¸ºé—­åŒ…å¯ä»¥ä½¿å‡½æ•°ä¸­çš„å˜é‡éƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œé€ æˆå¾ˆå¤§çš„å†…å­˜æ¶ˆè€—ï¼Œæ‰€ä»¥å¦‚æœ ä¸æ˜¯æŸäº›ç‰¹å®šçš„ä»»åŠ¡éœ€è¦ä½¿ç”¨é—­åŒ…ï¼Œæˆ‘ä»¬ä¸è¦æ»¥ç”¨å®ƒã€‚

å¾ˆå¤šåšå®¢ä¸­éƒ½æåˆ°äº†è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯å…¶å®éƒ½æ˜¯ä¸å®Œå…¨å¯¹çš„ã€‚

**æ•²é»‘æ¿ï¼ï¼ï¼**

ä½¿ç”¨ä¸å½“çš„é—­åŒ…ä¼šåœ¨`IE(IE9)`ä¹‹å‰é€ æˆå†…å­˜æ³„æ¼é—®é¢˜ã€‚å› ä¸ºå®ƒçš„`JavaScript`å¼•æ“ä½¿ç”¨çš„åƒåœ¾å›æ”¶ç®—æ³•æ˜¯å¼•ç”¨è®¡æ•°æ³•ï¼Œå¯¹äºå¾ªç¯å¼•ç”¨å°†ä¼šå¯¼è‡´`GC`(ä¸‹æ–‡ä¼šä»‹ç»)æ— æ³•å›æ”¶åƒåœ¾ã€‚

å…³äºå„ä¸ªæµè§ˆå™¨çš„é—­åŒ…æµ‹è¯•ï¼Œè¯¦æƒ…è¯·è§[å¸å¾’æ­£ç¾-jsé—­åŒ…æµ‹è¯•](https://www.cnblogs.com/rubylouvre/p/3345294.html)

## åƒåœ¾å›æ”¶æœºåˆ¶
éƒ½9102å¹´äº†ï¼Œå…¨å›½å¼€å§‹å®è¡Œåƒåœ¾åˆ†ç±»äº†ï¼Œä½ å±…ç„¶è¿˜ä¸çŸ¥é“åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œèµ¶å¿«æ¥è¡¥ä¹ ä¸€ä¸‹ï¼

åƒåœ¾å›æ”¶ä¹Ÿå°±æ˜¯`GC(Garbage Collection)`ã€‚

`GC`æŠŠç¨‹åºä¸ç”¨çš„å†…å­˜ç©ºé—´è§†ä¸ºåƒåœ¾ï¼Œæ‰¾åˆ°å®ƒä»¬å¹¶ä¸”å°†å®ƒä»¬å›æ”¶ï¼Œè®©ç¨‹åºå‘˜å¯ä»¥å†æ¬¡åˆ©ç”¨è¿™éƒ¨åˆ†ç©ºé—´ã€‚

ä¸æ˜¯æ‰€æœ‰çš„è¯­è¨€éƒ½æœ‰`GC`ï¼Œä¸€èˆ¬å­˜åœ¨äºé«˜çº§è¯­è¨€ä¸­ï¼Œå¦‚`Java`ã€`JavaScript`ã€`Python`ã€‚é‚£ä¹ˆåœ¨æ²¡æœ‰`GC`çš„ä¸–ç•Œé‡Œï¼Œç¨‹åºå‘˜å°±æ¯”è¾ƒè¾›è‹¦ï¼Œåªèƒ½æ‰‹åŠ¨å»ç®¡ç†å†…å­˜ï¼Œæ¯”å¦‚åœ¨`C`è¯­è¨€ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡`malloc/free`ï¼Œåœ¨`C++`ä¸­çš„`new/delete`æ¥è¿›è¡Œç®¡ç†ã€‚


## åƒåœ¾å›æ”¶ç®—æ³•
å› ä¸ºè¿™ä¸€éƒ¨åˆ†çš„å†…å®¹å¾ˆå¤šï¼Œæœ¬æ–‡åªè¿›è¡Œç®€å•çš„è®²è§£ï¼Œå¦‚æœæƒ³æ·±å…¥äº†è§£åƒåœ¾å›æ”¶ç®—æ³•çš„åŒå­¦å¯ä»¥åœ¨æ–‡æœ«è·å–å­¦ä¹ èµ„æ–™ã€‚
### GCæ ‡è®°-æ¸…é™¤ç®—æ³•
ä¸–ç•Œä¸Šé¦–ä¸ªå€¼å¾—çºªå¿µçš„`GC`ç®—æ³•æ˜¯`GCæ ‡è®°-æ¸…é™¤ç®—æ³•`ã€‚å› ä¸ºè‡ªå…¶é—®ä¸–ä»¥æ¥ï¼Œä¸€ç›´åˆ°åŠä¸ªä¸–çºªåçš„ä»Šå¤©ï¼Œå®ƒä¾ç„¶æ˜¯å„ç§å¤„ç†ç¨‹åºæ‰€ç”¨çš„ä¼Ÿå¤§çš„ç®—æ³•ã€‚

`GCæ ‡è®°-æ¸…é™¤ç®—æ³•`ç”±æ ‡è®°é˜¶æ®µå’Œæ¸…é™¤é˜¶æ®µæ„æˆï¼Œæ ‡è®°é˜¶æ®µå°†æ‰€æœ‰çš„æ´»åŠ¨å¯¹è±¡åšä¸Šç›¸åº”çš„æ ‡è®°ï¼Œæ¸…é™¤é˜¶æ®µæŠŠé‚£äº›æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éæ´»åŠ¨å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚åœ¨æœç´¢å¯¹è±¡å¹¶è¿›è¡Œæ ‡è®°çš„æ—¶å€™ä½¿ç”¨äº†æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œå°½å¯èƒ½çš„ä»æ·±åº¦ä¸Šæœç´¢æ ‘å½¢ç»“æ„ã€‚

ä¼˜ç‚¹ï¼š

> 1.ç®—æ³•ç®€å•ï¼Œå®ç°å®¹æ˜“ã€‚
>
> 2.ä¸ä¿å®ˆå¼çš„GCç®—æ³•å…¼å®¹ã€‚

ç¼ºç‚¹ï¼š

> 1.åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šå‡ºç°ç¢ç‰‡åŒ–çš„æƒ…å†µï¼Œå¦‚åŒ`Windows`çš„æ–‡ä»¶ç³»ç»Ÿä¸€æ ·ï¼Œå¯¼è‡´
> æ— æ•°çš„å°åˆ†å—æ•£å¸ƒåœ¨å †çš„å„ä¸ªåœ°æ–¹ã€‚
>
> 2.åˆ†é…é€Ÿåº¦ï¼Œç”±äºåˆ†å—çš„ä¸è¿ç»­æ€§ï¼Œç®—æ³•æ¯æ¬¡åˆ†é…çš„æ—¶å€™éƒ½éœ€è¦éå†ç©ºé—²é“¾è¡¨ä¸ºäº†æ‰¾åˆ°è¶³å¤Ÿå¤§çš„åˆ†å—ï¼Œè¿™æ ·æœ€ç³Ÿç³•çš„æƒ…å†µå°±æ˜¯éå†åˆ°æœ€åæ‰æ‰¾åˆ°åˆé€‚çš„åˆ†
> å—ï¼Œå½±å“äº†åˆ†é…é€Ÿåº¦ã€‚


### å¼•ç”¨è®¡æ•°æ³•

è¿™ç§æ–¹æ³•ä¸­å¼•å…¥äº†è®¡æ•°å™¨çš„æ¦‚å¿µï¼Œé€šè¿‡è®¡æ•°å™¨æ¥è¡¨ç¤ºå¯¹è±¡çš„â€œäººæ°”æŒ‡æ•°â€ï¼Œä¹Ÿå°±æ˜¯æœ‰å¤šå°‘ä¸ªç¨‹åºå¼•ç”¨äº†è¿™ä¸ªå¯¹è±¡ã€‚å½“è®¡æ•°å™¨(å¼•ç”¨æ•°)ä¸º0æ—¶ï¼Œåƒåœ¾ç«‹åˆ»è¢«å›æ”¶ã€‚

ä¼˜ç‚¹:

> 1.å¯ä»¥ç«‹å³å›æ”¶åƒåœ¾ã€‚
>
> 2.æœ€å¤§æš‚åœçš„æ—¶é—´çŸ­ã€‚
>
> 3.å¹¶ä¸”æ²¡æœ‰å¿…è¦æ²¿æŒ‡é’ˆæŸ¥æ‰¾ã€‚

ç¼ºç‚¹:
> 1.ä¸Šæ–‡æåˆ°è¿‡çš„å¾ªç¯å¼•ç”¨æ— æ³•å›æ”¶ã€‚
>
> 2.å¹¶ä¸”å®ç°èµ·æ¥å¾ˆå¤æ‚ã€‚
>
> 3.è®¡æ•°å™¨å€¼çš„å¢å‡å¤„ç†ååˆ†ç¹é‡ã€‚
>
> 4.åŒæ—¶è®¡æ•°å™¨éœ€è¦å å¾ˆå¤šä½ï¼Œå¯¼è‡´å†…å­˜ç©ºé—´çš„ä½¿ç”¨æ•ˆç‡å¤§å¤§é™ä½ã€‚


**è½¯ä»¶å·¥ç¨‹æ²¡æœ‰é“¶å¼¹**ï¼Œè¿™äº›ç¼ºç‚¹ä¹Ÿéƒ½æœ‰ç›¸åº”çš„åŠæ³•è¿›è¡Œè§£å†³ï¼Œå¦‚æœä½ æƒ³æ·±å…¥äº†è§£åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¯ä»¥è´­ä¹°[åƒåœ¾å›æ”¶çš„ç®—æ³•ä¸å®ç°](https://book.douban.com/subject/26821357/)è¿™æœ¬ä¹¦å»çœ‹ï¼Œå»ºè®®æ”¯æŒæ­£ç‰ˆã€‚




