---
title: "JavaScript Thisè¯¦è§£"
date: 2019-08-25T16:22:42+08:00
lastmod: 2019-08-25T16:22:42+08:00
draft: false
description: "JavaScript Thisè¯¦è§£"
show_in_homepage: true
show_description: false
license: ''

tags: ['JavaScript']
categories: ['å‰ç«¯']

featured_image: ''
featured_image_preview: ''

comment: true
toc: true
autoCollapseToc: true
math: true
---


ä½ çš®ä»»ä½ çš®ï¼Œæˆ‘å½“ä½ ç“œçš®ã€‚


ä¼—æ‰€å‘¨çŸ¥ï¼Œ`this`åœ¨JavaScriptä¸­çš„æŒ‡å‘ä¸€ç›´å¾ˆéš¾è®©äººç†è§£ï¼Œæƒ³è¦å­¦å¥½JavaScriptï¼Œ`this`ä¹Ÿæ˜¯æˆ‘ä»¬å¿…é¡»è¦ææ¸…æ¥šçš„ã€‚å…¶å®ï¼Œ`this`å¹¶æ²¡æœ‰é‚£ä¹ˆéš¾ï¼Œæœ¬æ–‡å°†åŠ›äº‰å¸¦ä½ æ²»ç–—`this`çš„â€œçš®â€ã€‚

<!--more-->

é¦–å…ˆï¼Œæ¥ç§‘æ™®ä¸‰ä¸ªé—®é¢˜ï¼

## thisæ˜¯ä»€ä¹ˆï¼Ÿ

**`this`æ˜¯å£°æ˜å‡½æ•°æ—¶é™„åŠ çš„å‚æ•°**ï¼ŒæŒ‡å‘ç‰¹å®šçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éšè—å‚æ•°ã€‚

æ¯”å¦‚LOLä¸­å„ç§éšè—çš„å½©è›‹ï¼Œå½“æ°´æ™¶å…ˆé”‹æ–¯å¡çº³åœ¨è‰ä¸›é‡Œåœç•™è¶…è¿‡15ç§’ä¸åŠ¨ï¼Œä¼šæ¨¡ä»¿å® ç‰©å°ç²¾çµã€‚

â€œçš®å¡ï¼çš®å¡ï¼çš®å¡ä¸˜ï¼â€

â€œæ–¯å¡ï¼æ–¯å¡ï¼æ–¯å¡çº³ï¼â€ 

å¥½ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»ç†è§£ä»€ä¹ˆæ˜¯`this`äº†ï¼Œå°±æ˜¯ä¸ªéšè—å‚æ•°ï¼Œæ²¡æœ‰å¤šä¹ˆçš„ç¥å¥‡ï¼Œå…¶å® æ¯ä¸ªå‡½æ•°éƒ½å¯ä»¥è®¿é—®`this`ã€‚

## ä¸ºä»€ä¹ˆè¦ä½¿ç”¨thisï¼Ÿ

`this`æä¾›äº†ä¸€ç§æ›´åŠ ä¼˜é›…çš„æ–¹å¼æ¥éšå¼çš„ä¼ é€’å¯¹è±¡å¼•ç”¨ã€‚

é€šä¿—åœ°è¯´ï¼šå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æŠŠAPIè®¾è®¡çš„æ›´åŠ ç®€æ´è€Œä¸”æ˜“äºå¤ç”¨ã€‚

è¯´äººè¯ï¼šé‚£å°±æ˜¯`this`å¯ä»¥å¸®æˆ‘ä»¬çœç•¥å‚æ•°ã€‚

## thisçš„æŒ‡å‘


åªéœ€è¦ç†è§£å¹¶è®°ä½ä¸€å¥è¯ï¼Œå¤–åŠ å‡ ç§å°æƒ…å†µï¼Œå¤§å®¶å°±å¯ä»¥å®Œå®Œå…¨å…¨çš„ç†è§£`this`ã€‚

å¥½ï¼Œæ³¨æ„å¬è®²ã€‚

è¿™å¥è¯å°±æ˜¯
â€œ**`this`çš„æŒ‡å‘åœ¨å‡½æ•°å£°æ˜çš„æ—¶å€™æ˜¯ä¸ä¼šè¢«ç¡®å®šçš„ï¼Œåªæœ‰å‡½æ•°æ‰§è¡Œçš„æ—¶å€™æ‰è¢«ç¡®å®šï¼Œ`this`æœ€ç»ˆæŒ‡å‘çš„æ˜¯è°ƒç”¨å®ƒçš„å¯¹è±¡**â€ã€‚

æœ‰äººè¯´è¿™ä¹Ÿå¤ªé•¿äº†ï¼Œè®°ä¸ä½ã€‚

å¥½ï¼Œé‚£ç¼©çŸ­ç‚¹ã€‚

ä¸€å¥è¯ã€‚

â€œ**`this`çš„æŒ‡å‘å†³å®šäºå‡½æ•°çš„è°ƒç”¨æ–¹å¼**â€ã€‚

æ€»ç»“ï¼š
> 1.`this`æ˜¯å£°æ˜å‡½æ•°æ—¶é™„åŠ çš„å‚æ•°ï¼ŒæŒ‡å‘ç‰¹å®šçš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯éšè—å‚æ•°ã€‚
>
> 2.`this`å¯ä»¥å¸®æˆ‘ä»¬çœç•¥å‚æ•°ã€‚
>
> 3.`this`çš„æŒ‡å‘å†³å®šäºå‡½æ•°çš„è°ƒç”¨æ–¹å¼ã€‚



æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œææ¸…æ¥šäº†è¿™ä¸‰ç‚¹ï¼Œæˆ‘ä»¬ä¸‹é¢å°†ä»å…«ç§æƒ…å†µæ¥å½»åº•ç†è§£`this`çš„æŒ‡å‘é—®é¢˜ã€‚

ç›´æ¥ä¸Šä»£ç ã€‚

### ä¸€ã€ç›´åˆ°ä¸–ç•Œå°½å¤´

(å¯¹ï¼Œæ²¡é”™ï¼Œæœ‰æ²¡æœ‰æƒ³èµ·çŒç¯®é«˜æ‰‹ä¸»é¢˜æ›²)

æˆ‘ä»¬é¦–å…ˆè¦äº†è§£ä¸€ä¸‹ä¸–ç•Œè§‚ï¼Œåˆ†ä¸ºä¸‰ç§æƒ…å†µã€‚

> 1.åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæµè§ˆå™¨ä¸­çš„å°½å¤´å½“ç„¶å°±æ˜¯`window`ã€‚
>
> 2.åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¹Ÿå°±æ˜¯å¼€å¯äº†`"use strict"`çš„æƒ…å†µä¸‹ï¼Œå°½å¤´å°±æ˜¯`undefined`ã€‚
>
> 3.`node`çš„å…¨å±€ç¯å¢ƒä¸­å°½å¤´æ˜¯`global`ã€‚

ä¸‹æ–‡ä¸­æƒ…å†µä¸»è¦ä»ç¬¬ä¸€ç§éä¸¥æ ¼æ¨¡å¼ä¸‹æ¥å¯¹`this`çš„æŒ‡å‘è¿›è¡Œè§£é‡Šå’Œè¯´æ˜ã€‚

```javascript



// æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¸¤ä¸ªğŸŒ°ã€‚

function demo(){
  var user = â€œå‰ç«¯é£Ÿå ‚â€;
  console.log(this.user);   // undefined
  console.log(this);       // window
}

demo();

// è¿™é‡Œçš„å‡½æ•°demoå®é™…ä¸Šæ˜¯è¢«windowå¯¹è±¡ä½¿ç”¨ç‚¹è¯­æ³•æ‰€ç‚¹å‡ºæ¥çš„ï¼Œå¦‚ä¸‹ï¼š

function demo(){
    var user = â€œå‰ç«¯é£Ÿå ‚â€;
    console.log(this.user);    // undefined
    console.log(this);        // window
}

window.demo();

// å¯ä»¥å‘ç°å’Œä¸Šé¢çš„ä»£ç ç»“æœä¸€æ ·

```


### äºŒã€ç”»é¾™ç‚¹ç›


```javascript
var obj = {
  user:â€å‰ç«¯é£Ÿå ‚â€,
  fn:function(){
     console.log(this.user);   // å‰ç«¯é£Ÿå ‚
  }
}

obj.fn();

// è¿™é‡Œçš„thisæŒ‡å‘å¯¹è±¡obj
// æ³¨æ„çœ‹æœ€åä¸€è¡Œè°ƒç”¨å‡½æ•°çš„ä»£ç 
// obj.fn();

// é‡è¦çš„äº‹æƒ…è¯´ä¸¤éï¼ï¼
// thisçš„æŒ‡å‘åœ¨å‡½æ•°åˆ›å»ºæ—¶æ˜¯å†³å®šä¸äº†çš„
// åœ¨è°ƒç”¨çš„æ—¶å€™æ‰å¯ä»¥å†³å®šï¼Œè°è°ƒç”¨å°±æŒ‡å‘è°

// thisçš„æŒ‡å‘åœ¨å‡½æ•°åˆ›å»ºæ—¶æ˜¯å†³å®šä¸äº†çš„
// åœ¨è°ƒç”¨çš„æ—¶å€™æ‰å¯ä»¥å†³å®šï¼Œè°è°ƒç”¨å°±æŒ‡å‘è°

```



### ä¸‰ã€ç‚¹çŸ³æˆé‡‘


```javascript
// å…¶å®ä»¥ä¸Šä¸¤ç‚¹è¯´çš„è¿˜ä¸å¤Ÿå‡†ç¡®ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹

var obj = {
  user:â€å‰ç«¯é£Ÿå ‚â€,
  fn:function(){
     console.log(this.user); // å‰ç«¯é£Ÿå ‚
  }
}
window.obj.fn(); 

// è¿™æ®µä»£ç è·Ÿä¸Šé¢çš„ä»£ç å‡ ä¹æ˜¯ä¸€æ ·çš„
// ä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰æŒ‡å‘windowå‘¢ï¼Ÿ
// æŒ‰ä½ ä¸Šé¢è¯´çš„ä¸æ˜¯windowè°ƒç”¨çš„æ–¹æ³•å—ï¼Ÿ
// å¤§å®¶å…ˆåœä¸‹æ¥æ‰“ä¸ªdebuggeræ€è€ƒä¸€ä¸‹ä¸ºä»€ä¹ˆ
// æƒ³ä¸æ˜ç™½æ²¡å…³ç³»æˆ‘ä»¬å¸¦ç€ç–‘é—®æ¥çœ‹ä¸‹æ®µä»£ç 

var obj = {
    a:1,
    b:{
        a:2,
        fn:function(){
            console.log(this.a); // 2
        }
    }
}

obj.b.fn();

// è¿™é‡Œæ‰§è¡Œçš„æ—¶å€™åŒæ ·æ˜¯å¯¹è±¡objé€šè¿‡ç‚¹è¯­æ³•è¿›è¡Œçš„æ‰§è¡Œ
// ä½†æ˜¯thisåŒæ ·æ²¡æœ‰æŒ‡å‘windowï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

// å¥½ï¼Œæˆ‘ä»¬æœ‰å‡ ç§æƒ…å†µéœ€è¦è®°ä½ï¼š

// 1.å¦‚æœä¸€ä¸ªå‡½æ•°ä¸­æœ‰this
// ä½†æ˜¯å®ƒæ²¡æœ‰è¢«ä¸Šä¸€çº§çš„å¯¹è±¡æ‰€è°ƒç”¨
// é‚£ä¹ˆthiså°±ä¼šæŒ‡å‘windowï¼ˆéä¸¥æ ¼æ¨¡å¼ä¸‹ï¼‰

// 2.å¦‚æœä¸€ä¸ªå‡½æ•°ä¸­æœ‰this
// è¿™ä¸ªå‡½æ•°åˆè¢«ä¸Šä¸€çº§çš„å¯¹è±¡æ‰€è°ƒç”¨
// é‚£ä¹ˆthiså°±ä¼šæŒ‡å‘ä¸Šä¸€çº§çš„å¯¹è±¡

// 3.å¦‚æœä¸€ä¸ªå‡½æ•°ä¸­æœ‰this
// è¿™ä¸ªå‡½æ•°ä¸­åŒ…å«å¤šä¸ªå¯¹è±¡
// å°½ç®¡è¿™ä¸ªå‡½æ•°æ˜¯è¢«æœ€å¤–å±‚çš„å¯¹è±¡æ‰€è°ƒç”¨
// thiså´ä¼šæŒ‡å‘å®ƒçš„ä¸Šä¸€çº§å¯¹è±¡

var obj = {
  a:1;
  b:{
    // a:2,
    fn:function(){
       console.log(this.a);   // undefined
    }
  }
}
obj.b.fn();

// æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹è±¡bä¸­æ²¡æœ‰å±æ€§aï¼Œè¿™ä¸ªthisæŒ‡å‘
// çš„ä¹Ÿæ˜¯å¯¹è±¡bï¼Œå› ä¸ºthisåªä¼šæŒ‡å‘å®ƒçš„ä¸Šä¸€çº§å¯¹è±¡
// ä¸ç®¡è¿™ä¸ªå¯¹è±¡ä¸­æœ‰æ²¡æœ‰thisè¦çš„ä¸œè¥¿

// æˆ‘ä»¬å†æ¥çœ‹ä¸€ç§æƒ…å†µ

var obj = {
    a:1,
    b:{
        a:2,
        fn:function(){
            console.log(this.a);  // undefined
            console.log(this);   // window
        }
    }
}
var demo = obj.b.fn;
demo();

// åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼ŒthisæŒ‡å‘çš„æ˜¯window
// ä½ ä»¬å¯èƒ½ä¼šè§‰å¾—å¾ˆå¥‡æ€ª
// å…¶å®æ˜¯è¿™æ ·çš„ï¼Œæœ‰ä¸€å¥è¯å¾ˆå…³é”®ï¼Œå†æ¬¡æ•²é»‘æ¿

// thisæ°¸è¿œæŒ‡å‘çš„éƒ½æ˜¯æœ€åè°ƒç”¨å®ƒçš„å¯¹è±¡
// ä¹Ÿå°±æ˜¯çœ‹å®ƒæ‰§è¡Œçš„æ—¶å€™æ˜¯è°è°ƒç”¨çš„

// ä¸Šé¢çš„ä¾‹å­ä¸­è™½ç„¶å‡½æ•°fnæ˜¯è¢«å¯¹è±¡bæ‰€å¼•ç”¨äº†
// ä½†æ˜¯åœ¨å°†fnèµ‹å€¼ç»™å˜é‡demoçš„æ—¶å€™å¹¶æ²¡æœ‰æ‰§è¡Œ
// æ‰€ä»¥æœ€ç»ˆthisæŒ‡å‘çš„æ˜¯window
```



### å››ã€é’æ¢…ç«¹é©¬


```javascript
function returnThis(){
  return this;
}
var user = {name:"å‰ç«¯é£Ÿå ‚"};

returnThis();            // window
returnThis.call(user);   // å‰ç«¯é£Ÿå ‚
returnThis.apply(user) ; // å‰ç«¯é£Ÿå ‚

// è¿™é‡Œå°±æ˜¯Object.prototype.call
// å’ŒObject.prototype.applyæ–¹æ³•
// ä»–ä»¬å¯ä»¥é€šè¿‡å‚æ•°æ¥æŒ‡å®šthis

```




### äº”ã€çŸ¢å¿—ä¸æ¸


```javascript
function returnThis(){
  return this;
}

var user1 = {name:"å‰ç«¯é£Ÿå ‚"};
var user1returnThis = returnThis.bind(user1);
user1returnThis();             // å‰ç«¯é£Ÿå ‚
var user2 = {name:"å‰ç«¯å°é£Ÿå ‚"};
user1returnThis.call(user2);   // still å‰ç«¯é£Ÿå ‚

// Object.prototype.bindé€šè¿‡ä¸€ä¸ªæ–°å‡½æ•°æ¥æä¾›äº†æ°¸ä¹…çš„ç»‘å®š
// è€Œä¸”ä¼šè¦†ç›–callå’Œapplyçš„æŒ‡å‘

```



### å…­ã€ä¹¾å¤å¤§æŒªç§»


```javascript
function Fn(){
  this.user = "å‰ç«¯é£Ÿå ‚";
}
var demo = new Fn();
console.log(demo.user);  // å‰ç«¯é£Ÿå ‚

// è¿™é‡Œnewå…³é”®å­—æ”¹å˜äº†thisçš„æŒ‡å‘
// newå…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡å®ä¾‹
// æ‰€ä»¥å¯ä»¥é€šè¿‡å¯¹è±¡demoç‚¹è¯­æ³•ç‚¹å‡ºå‡½æ•°Fné‡Œé¢çš„user
// è¿™ä¸ªthisæŒ‡å‘å¯¹è±¡demo

// æ³¨æ„ï¼šè¿™é‡Œnewä¼šè¦†ç›–bindçš„ç»‘å®š
function demo(){
  console.log(this);
}

demo();             // window
new demo();         // demo
var user1 = {name:"å‰ç«¯é£Ÿå ‚"};
demo.call(user1);   // å‰ç«¯é£Ÿå ‚

var user2 = demo.bind(user1);
user2();            // å‰ç«¯é£Ÿå ‚
new user2();        // demo

```



### ä¸ƒã€çˆ±è½¬è§’é‡ä¸Šreturn


```javascript
// å½“thisé‡ä¸Šreturnæ—¶
function fn(){
  this.user = "å‰ç«¯é£Ÿå ‚";
  return{};
}
var a = new fn;
console.log(a.user);  // undefined

function fn(){
  this.user = "å‰ç«¯é£Ÿå ‚";
  return function(){};
}
var a = new fn;
console.log(a.user);  // undefined

function fn(){
  this.user = "å‰ç«¯é£Ÿå ‚";
  return 1;
}
var a = new fn;
console.log(a.user); // å‰ç«¯é£Ÿå ‚

function fn(){
  this.user = "å‰ç«¯é£Ÿå ‚";
  return undefined;
}
var a = new fn;
console.log(a.user); // å‰ç«¯é£Ÿå ‚

// æ€»ç»“ï¼šå¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡
// é‚£ä¹ˆthisæŒ‡å‘å°±æ˜¯è¿”å›çš„å¯¹è±¡
// å¦‚æœè¿”å›å€¼ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡
// é‚£ä¹ˆthisè¿˜æ˜¯æŒ‡å‘å‡½æ•°çš„å®ä¾‹

// nullæ¯”è¾ƒç‰¹æ®Šï¼Œè™½ç„¶å®ƒæ˜¯å¯¹è±¡
// ä½†æ˜¯è¿™é‡Œthisè¿˜æ˜¯æŒ‡å‘é‚£ä¸ªå‡½æ•°çš„å®ä¾‹

function fn(){
  this.user = "å‰ç«¯é£Ÿå ‚";
  return null;
}
var a = new fn;
console.log(a.user); // å‰ç«¯é£Ÿå ‚

```



### å…«ã€è‹±é›„ç™»åœº


```javascript

// æœ€åæˆ‘ä»¬ä»‹ç»ä¸€ç§åœ¨ES6ä¸­çš„ç®­å¤´å‡½æ•°
// è¿™ä¸ªç®­å¤´å‡½æ•°ä¸­çš„thisè¢«åŠ é‡Œå¥¥çš„è‹±é›„ç™»åœºé”¤çš„ä¸è¡Œ
// çš®ä¸èµ·æ¥äº†
// è€Œä¸”ï¼Œåœ¨ä»£ç è¿è¡Œå‰å°±å·²ç»è¢«ç¡®å®šäº†ä¸‹æ¥
// è°ä¹Ÿä¸èƒ½æŠŠå®ƒè¦†ç›–

// è¿™æ ·æ˜¯ä¸ºäº†æ–¹ä¾¿è®©å›è°ƒå‡½æ•°ä¸­thisä½¿ç”¨å½“å‰çš„ä½œç”¨åŸŸ
// è®©thisæŒ‡é’ˆæ›´åŠ çš„æ¸…æ™°
// æ‰€ä»¥å¯¹äºç®­å¤´å‡½æ•°ä¸­çš„thisæŒ‡å‘
// æˆ‘ä»¬åªè¦çœ‹å®ƒåˆ›å»ºçš„ä½ç½®å³å¯

function callback(qdx){
  qdx();
}
callback(()=>{console.log(this)});        // window

var user = {
    name:"å‰ç«¯é£Ÿå ‚",
    callback:callback,
    callback1(){
      callback(()=>{console.log(this)});
    }
}
user.callback(()=>{console.log(this)});  // still window
user.callback1(()=>{console.log(this)}); // user
```


æ€ä¹ˆæ ·ï¼Ÿthiså…¶å®ä¸è¿‡å¦‚æ­¤å§ã€‚å†çš®ä¹Ÿè¦æ²»ä½ä»–~
